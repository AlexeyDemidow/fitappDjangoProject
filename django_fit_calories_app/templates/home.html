{% extends 'base.html' %}
{% load static %}

{% block title %}Следим за фигурой{% endblock %}

{% block content %}
    {% if user.is_authenticated %}
        <div class="container">
            Добро пожаловать, {{ user.username }}!
            <p>Ваша статистика за {{ main_date }}</p>
            <form action="" method="POST">
                {% csrf_token %}
                <input type="date" id="{{ form_ch.c_date }}
                <input type="submit" class="btn btn-success" value="Выбрать">
            </form>
            <h3>Количество употребленных продуктов: {{cnt}}</h3>
            <div class="today">
                <div class="flex-box-row">
                    {% if user.calories > 0 %}
                        <h3>Количество калорий: {{user.calories}}</h3>
                    {% else %}
                        <h3>Количество калорий: {{user.calories_per_day}}</h3>
                    {% endif %}
                    <h3>Всего калорий употреблено: {{totalCalories}}</h3>
                    <h3>Осталось: {{ CalorieLeft }}</h3>
                </div>
            </div>
        <div/>
        <div class="container">
          <div class="row">
            <div class="col-md-6">
                Завтрак
                <canvas id="chart_breakfast"></canvas>
            </div>
            <div class="col-md-6">
                Обед
                <canvas id="chart_dinner"></canvas>
            </div>
          </div>
            <div class="row">
                <div class="col-md-6">
                    Ужин
                    <canvas id="chart_lunch"></canvas>
                </div>
                <div class="col-md-6">
                    Перекусы
                    <canvas id="chart_snacks"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                    Калории
                    <canvas id="chart_calories"></canvas>
            </div>
        </div>

        <script>
            var br_config = {
              type: 'pie',
              data: {
                datasets: [{
                  data: {{ data_breakfast|safe }},
                  backgroundColor: [
                    '#FF0000', '#FFFF00', '#32CD32'
                  ],
                  label: 'Breakfast'
                }],
                labels: {{ food_nutrients_labels|safe }}
              },
              options: {
                responsive: true
              }
            };

            var lu_config = {
              type: 'pie',
              data: {
                datasets: [{
                  data: {{ data_lunch|safe }},
                  backgroundColor: [
                    '#FF0000', '#FFFF00', '#32CD32'
                  ],
                  label: 'Lunch'
                }],
                labels: {{ food_nutrients_labels|safe }}
              },
              options: {
                responsive: true
              }
            };

            var di_config = {
              type: 'pie',
              data: {
                datasets: [{
                  data: {{ data_dinner|safe }},
                  backgroundColor: [
                    '#FF0000', '#FFFF00', '#32CD32'
                  ],
                  label: 'Dinner'
                }],
                labels: {{ food_nutrients_labels|safe }}
              },
              options: {
                responsive: true
              }
            };

            var sn_config = {
              type: 'pie',
              data: {
                datasets: [{
                  data: {{ data_snacks|safe }},
                  backgroundColor: [
                    '#FF0000', '#FFFF00', '#32CD32'
                  ],
                  label: 'Snacks'
                }],
                labels: {{ food_nutrients_labels|safe }}
              },
              options: {
                responsive: true
              }
            };

            var cal_config = {
              type: 'bar',
              data: {
                datasets: [{
                  data: {{ food_category_data|safe }},
                  backgroundColor: [
                    '#0000FF', '#1E90FF', '#00BFFF', '#00FFFF'
                  ],
                  label: 'Завтрак'
                }],
                labels: {{ food_category_labels|safe }}
              },
              options: {
                responsive: true,
                legend: {
                    display: false
                }
              }
            };

            window.onload = function() {
              var br = document.getElementById('chart_breakfast').getContext('2d');
              window.myPie = new Chart(br, br_config);

              var lu = document.getElementById('chart_lunch').getContext('2d');
              window.myPie = new Chart(lu, lu_config);

              var di = document.getElementById('chart_dinner').getContext('2d');
              window.myPie = new Chart(di, di_config);

              var sn = document.getElementById('chart_snacks').getContext('2d');
              window.myPie = new Chart(sn, sn_config);

              var cal = document.getElementById('chart_calories').getContext('2d');
              window.myPie = new Chart(cal, cal_config);
            };
        </script>
    {% else %}
        <div class="container">
            <p>Вы не авторизированы. Нажмите "Войти" чтобы войти и "Регистрация" чтобы зарегистрироваться.</p>
            <a href="{% url 'login' %}"><input class="button" type="submit" value="Войти"></a>
            <a href="{% url 'signup'%}"><input class="button" type="submit" value="Регистрация"></a>
        </div>
    {% endif %}
{% endblock %}